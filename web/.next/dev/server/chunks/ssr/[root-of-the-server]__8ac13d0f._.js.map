{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///E:/%E5%AD%97%E8%8A%82-%E8%AF%BE%E5%90%8E%E4%BD%9C%E4%B8%9A-2/Github/ssr-blog-starter/web/pages/index.js"],"sourcesContent":["// web/pages/index.js\r\nimport { useEffect, useState } from 'react';\r\nimport Link from 'next/link';\r\n\r\nexport default function Home({ ssrArticles = [], ssrDegraded = false }) {\r\n    const [articles, setArticles] = useState(ssrArticles);\r\n    const [degraded, setDegraded] = useState(ssrDegraded);\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    useEffect(() => {\r\n        if (degraded && articles.length === 0) {\r\n            // try client fetch to recover\r\n            (async () => {\r\n                setLoading(true);\r\n                try {\r\n                    const r = await fetch(`/api/v1/articles?page=1&limit=10`);\r\n                    if (r.ok) {\r\n                        const data = await r.json();\r\n                        if (data && data.value) setArticles(data.value);\r\n                        setDegraded(false);\r\n                    }\r\n                } catch (e) {\r\n                    // still degraded\r\n                } finally {\r\n                    setLoading(false);\r\n                }\r\n            })();\r\n        }\r\n    }, [degraded, articles.length]);\r\n\r\n    return (\r\n        <div style={{ padding: 24 }}>\r\n            <h1>文章列表</h1>\r\n            {degraded && <div style={{ color: 'orange' }}>服务器负载/数据不可用，已降级 — 正在尝试恢复...</div>}\r\n            {loading && <div>加载中...</div>}\r\n            <ul>\r\n                {articles.length === 0 ? (\r\n                    <li>暂无文章</li>\r\n                ) : (\r\n                    articles.map(a => (\r\n                        <li key={a.id} style={{ marginBottom: 12 }}>\r\n                            <h3><Link href={`/articles/${a.id}`} legacyBehavior><a>{a.title}</a></Link></h3>\r\n                            <p>{a.summary}</p>\r\n                        </li>\r\n                    ))\r\n                )}\r\n            </ul>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport async function getServerSideProps(ctx) {\r\n    const API = process.env.API_BASE || 'http://localhost:3000';\r\n    try {\r\n        const controller = new AbortController();\r\n        const t = setTimeout(() => controller.abort(), 1800);\r\n        const res = await fetch(`${API}/api/v1/articles?page=1&limit=10`, { signal: controller.signal });\r\n        clearTimeout(t);\r\n        if (!res.ok) throw new Error('api not ok');\r\n        const data = await res.json();\r\n        return { props: { ssrArticles: data.value || [], ssrDegraded: !!data.degraded } };\r\n    } catch (e) {\r\n        // return skeleton (降级)\r\n        return { props: { ssrArticles: [], ssrDegraded: true } };\r\n    }\r\n}\r\n"],"names":[],"mappings":"AAAA,qBAAqB;;;;;;;;AACrB;AACA;;;;AAEe,SAAS,KAAK,EAAE,cAAc,EAAE,EAAE,cAAc,KAAK,EAAE;IAClE,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,+GAAQ,EAAC;IACzC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,+GAAQ,EAAC;IACzC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,+GAAQ,EAAC;IAEvC,IAAA,gHAAS,EAAC;QACN,IAAI,YAAY,SAAS,MAAM,KAAK,GAAG;YACnC,8BAA8B;YAC9B,CAAC;gBACG,WAAW;gBACX,IAAI;oBACA,MAAM,IAAI,MAAM,MAAM,CAAC,gCAAgC,CAAC;oBACxD,IAAI,EAAE,EAAE,EAAE;wBACN,MAAM,OAAO,MAAM,EAAE,IAAI;wBACzB,IAAI,QAAQ,KAAK,KAAK,EAAE,YAAY,KAAK,KAAK;wBAC9C,YAAY;oBAChB;gBACJ,EAAE,OAAO,GAAG;gBACR,iBAAiB;gBACrB,SAAU;oBACN,WAAW;gBACf;YACJ,CAAC;QACL;IACJ,GAAG;QAAC;QAAU,SAAS,MAAM;KAAC;IAE9B,qBACI,qKAAC;QAAI,OAAO;YAAE,SAAS;QAAG;;0BACtB,qKAAC;0BAAG;;;;;;YACH,0BAAY,qKAAC;gBAAI,OAAO;oBAAE,OAAO;gBAAS;0BAAG;;;;;;YAC7C,yBAAW,qKAAC;0BAAI;;;;;;0BACjB,qKAAC;0BACI,SAAS,MAAM,KAAK,kBACjB,qKAAC;8BAAG;;;;;2BAEJ,SAAS,GAAG,CAAC,CAAA,kBACT,qKAAC;wBAAc,OAAO;4BAAE,cAAc;wBAAG;;0CACrC,qKAAC;0CAAG,cAAA,qKAAC,uIAAI;oCAAC,MAAM,CAAC,UAAU,EAAE,EAAE,EAAE,EAAE;oCAAE,cAAc;8CAAC,cAAA,qKAAC;kDAAG,EAAE,KAAK;;;;;;;;;;;;;;;;0CAC/D,qKAAC;0CAAG,EAAE,OAAO;;;;;;;uBAFR,EAAE,EAAE;;;;;;;;;;;;;;;;AASrC;AAEO,eAAe,mBAAmB,GAAG;IACxC,MAAM,MAAM,6DAAwB;IACpC,IAAI;QACA,MAAM,aAAa,IAAI;QACvB,MAAM,IAAI,WAAW,IAAM,WAAW,KAAK,IAAI;QAC/C,MAAM,MAAM,MAAM,MAAM,GAAG,IAAI,gCAAgC,CAAC,EAAE;YAAE,QAAQ,WAAW,MAAM;QAAC;QAC9F,aAAa;QACb,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM;QAC7B,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,OAAO;YAAE,OAAO;gBAAE,aAAa,KAAK,KAAK,IAAI,EAAE;gBAAE,aAAa,CAAC,CAAC,KAAK,QAAQ;YAAC;QAAE;IACpF,EAAE,OAAO,GAAG;QACR,uBAAuB;QACvB,OAAO;YAAE,OAAO;gBAAE,aAAa,EAAE;gBAAE,aAAa;YAAK;QAAE;IAC3D;AACJ"}}]
}