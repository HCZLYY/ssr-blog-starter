{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///E:/%E5%AD%97%E8%8A%82-%E8%AF%BE%E5%90%8E%E4%BD%9C%E4%B8%9A-2/Github/ssr-blog-starter/web/pages/articles/%5Bid%5D.js"],"sourcesContent":["// web/pages/articles/[id].js\r\nimport { useRouter } from 'next/router';\r\nimport { useEffect, useState } from 'react';\r\nimport Link from 'next/link';\r\n\r\nexport default function ArticlePage({ ssrArticle = null, ssrDegraded = false }) {\r\n    const router = useRouter();\r\n    const [article, setArticle] = useState(ssrArticle);\r\n    const [degraded, setDegraded] = useState(ssrDegraded);\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    useEffect(() => {\r\n        if (degraded && !article) {\r\n            (async () => {\r\n                setLoading(true);\r\n                try {\r\n                    const r = await fetch(`/api/v1/articles/${router.query.id}`);\r\n                    if (r.ok) {\r\n                        const data = await r.json();\r\n                        setArticle(data);\r\n                        setDegraded(false);\r\n                    }\r\n                } catch (e) {\r\n                    // keep degraded\r\n                } finally {\r\n                    setLoading(false);\r\n                }\r\n            })();\r\n        }\r\n    }, [degraded, article, router.query.id]);\r\n\r\n    if (!article && !degraded) return <div>文章未找到</div>;\r\n\r\n    return (\r\n        <div style={{ padding: 24 }}>\r\n            <Link href=\"/\" legacyBehavior><a>← 返回列表</a></Link>\r\n            {degraded && <div style={{ color: 'orange' }}>文章服务临时不可用，尝试客户端拉取中...</div>}\r\n            {loading && <div>加载中...</div>}\r\n            {article ? (\r\n                <>\r\n                    <h1>{article.title}</h1>\r\n                    <div dangerouslySetInnerHTML={{ __html: article.content }} />\r\n                </>\r\n            ) : (\r\n                <div>文章暂不可用</div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport async function getServerSideProps(ctx) {\r\n    const { id } = ctx.params;\r\n    const API = process.env.API_BASE || 'http://localhost:3000';\r\n    try {\r\n        const controller = new AbortController();\r\n        const t = setTimeout(() => controller.abort(), 1800);\r\n        const res = await fetch(`${API}/api/v1/articles/${id}`, { signal: controller.signal });\r\n        clearTimeout(t);\r\n        if (!res.ok) throw new Error('api not ok');\r\n        const data = await res.json();\r\n        return { props: { ssrArticle: data, ssrDegraded: !!data.degraded } };\r\n    } catch (e) {\r\n        return { props: { ssrArticle: null, ssrDegraded: true } };\r\n    }\r\n}\r\n"],"names":[],"mappings":"AAAA,6BAA6B;;;;;;;;AAC7B;AACA;AACA;;;;;AAEe,SAAS,YAAY,EAAE,aAAa,IAAI,EAAE,cAAc,KAAK,EAAE;IAC1E,MAAM,SAAS,IAAA,oIAAS;IACxB,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,+GAAQ,EAAC;IACvC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,+GAAQ,EAAC;IACzC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,+GAAQ,EAAC;IAEvC,IAAA,gHAAS,EAAC;QACN,IAAI,YAAY,CAAC,SAAS;YACtB,CAAC;gBACG,WAAW;gBACX,IAAI;oBACA,MAAM,IAAI,MAAM,MAAM,CAAC,iBAAiB,EAAE,OAAO,KAAK,CAAC,EAAE,EAAE;oBAC3D,IAAI,EAAE,EAAE,EAAE;wBACN,MAAM,OAAO,MAAM,EAAE,IAAI;wBACzB,WAAW;wBACX,YAAY;oBAChB;gBACJ,EAAE,OAAO,GAAG;gBACR,gBAAgB;gBACpB,SAAU;oBACN,WAAW;gBACf;YACJ,CAAC;QACL;IACJ,GAAG;QAAC;QAAU;QAAS,OAAO,KAAK,CAAC,EAAE;KAAC;IAEvC,IAAI,CAAC,WAAW,CAAC,UAAU,qBAAO,qKAAC;kBAAI;;;;;;IAEvC,qBACI,qKAAC;QAAI,OAAO;YAAE,SAAS;QAAG;;0BACtB,qKAAC,gIAAI;gBAAC,MAAK;gBAAI,cAAc;0BAAC,cAAA,qKAAC;8BAAE;;;;;;;;;;;YAChC,0BAAY,qKAAC;gBAAI,OAAO;oBAAE,OAAO;gBAAS;0BAAG;;;;;;YAC7C,yBAAW,qKAAC;0BAAI;;;;;;YAChB,wBACG;;kCACI,qKAAC;kCAAI,QAAQ,KAAK;;;;;;kCAClB,qKAAC;wBAAI,yBAAyB;4BAAE,QAAQ,QAAQ,OAAO;wBAAC;;;;;;;6CAG5D,qKAAC;0BAAI;;;;;;;;;;;;AAIrB;AAEO,eAAe,mBAAmB,GAAG;IACxC,MAAM,EAAE,EAAE,EAAE,GAAG,IAAI,MAAM;IACzB,MAAM,MAAM,6DAAwB;IACpC,IAAI;QACA,MAAM,aAAa,IAAI;QACvB,MAAM,IAAI,WAAW,IAAM,WAAW,KAAK,IAAI;QAC/C,MAAM,MAAM,MAAM,MAAM,GAAG,IAAI,iBAAiB,EAAE,IAAI,EAAE;YAAE,QAAQ,WAAW,MAAM;QAAC;QACpF,aAAa;QACb,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM;QAC7B,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,OAAO;YAAE,OAAO;gBAAE,YAAY;gBAAM,aAAa,CAAC,CAAC,KAAK,QAAQ;YAAC;QAAE;IACvE,EAAE,OAAO,GAAG;QACR,OAAO;YAAE,OAAO;gBAAE,YAAY;gBAAM,aAAa;YAAK;QAAE;IAC5D;AACJ"}}]
}